# Пояснения к выполненному заданию

Я сделал исходник статьи на Asciidoc и сгенерировал из него DocBook, а также страницу html.
Чтобы увидеть результат, можно просто скачать страницу html и открыть ее в браузере.

Чтобы собрать страницу из исходников, нужно клонировать проект и запустить asciidoctor с дефолтными настройками:

```sh
git clone https://github.com/abogdanov85/Postgrespro_Task.git
asciidoctor oops.adoc
```

Чтобы получить DocBook, нужно запустить asciidoctor в режиме бэкенда DocBook:

```sh
asciidoctor -b docbook oops.adoc
```

## Описание файлов проекта:
* `oops.adoc` - исходный файл статьи
* `templates/parameter_definition.adoc` - шаблон для параметров
* `templates/docstring.adoc` - шаблон для описания функций (докстрингов)
* `docstrings/function_create_projection.adoc` - описание (докстринг) функции `create_projection`
* `oops.html` - html страница статьи (собранная в asciidoctor)
* `oops.xml` - статья в виде DocBook (собранная в asciidoctor)

## Общие соображения

Я использовал Asciidoc, так как достаточно хорошо с ним знаком и мне нравится, какие возможности он предоставляет для создания технической документации.
Я сделал довольно сложную структуру проекта - отдельные файлы с шаблонами, отдельный файл с описанием функций и т.п.
Конечно, если задача состоит только в написании одной статьи, то такая сложная структура - это лишнее.
Но я исходил из того, что эта статья - часть большого проекта, в котором у нас есть много статей, много функций или других объектов для описания.
В таком случае шаблонизация и другие средства для унификации описаний очень полезны.

В файлах `adoc` есть мои комментарии для каждого объекта.
А общие соображения я описываю в этом README.

## Как работают файлы шаблонов и описаний функций

Идея состоит в том, чтобы максимально унифицировать документацию проекта и по возможности обеспечить единственное место описания для всех повторяющихся элементов.

В тексте статьи мы имеем подробное описание одной функции - `create_projection`.
Предположим, что таких объектов (функций, методов, констант, ключевых слов и т.п.) у нас много.
В таком случае очень полезно иметь стандартный шаблон для их описания, заданный в одном месте, чтобы на финальных страницах они выглядели однообразно, и чтобы при необходимости можно было поменять этот шаблон в одном месте для всех таких объектов.

Часто в языках программирования описания функций делаются в виде докстринга (docstring) непосредственно в программном коде, а потом импортируются в документацию.
Поэтому я использую этот термин здесь и в самом проекте.

Шаблон для докстрингов сделан в файле `templates/docstring.adoc`.
Он используется в файле `docstrings/function_create_projection.adoc` через тэги и  может использоваться для описания других объектов.
На вход он принимает два атрибута: имя объекта (`object_name`) и его тип (`object_type`).
Этот докстринг вынесен в отдельный файл в папке `docstrings`. 
Предполагается, что в этой папке будут отдельные файлы с описаниями всех подобных объектов.
В таком случае их удобно использовать на любых страницах проекта (через `include`), а при необходимости можно сгенерировать одну страницу (или один раздел) со описаниями всех функций модуля.
Обычно такие страницы называют "Справочник по API" или "Index" или просто "API".

В описании функции есть повторяющиеся элементы - это описания ее параметров.
Их я тоже сделал через шаблон, который описан в файле `templates/parameter_definition.adoc`.
Шаблон принимает на вход 4 атрибута: 
* `parameter_name` - имя параметра
* `parameter_value` - тип значения параметра
* `parameter_is_optional` - является ли параметр опциональным (если нет, то атрибут остается пустым)
* `parameter_description` - описание параметра

Все эти атрибуты верстаются в единый элемент списка `<dd>` (description definition).
Если нужно будет поменять верстку для параметров, например сделать вместо списка `<dd>` таблицу или что-то другое, то это можно будет сделать в одном месте - в файле шаблона, и верстка применится ко всем параметрам в описании всех объектов.

## Условные конструкции для поддержки версионирования

В тексте статьи говорится о том, что некоторая функциональность будет доступна только в будущем, а в данный момент нужно использовать другой инструмент (функцию вместо простой записи командой SQL).
В целом мне не кажется правильным делать такие "обещания" в технической документации (так как они могут не сбыться никогда или сбыться, но в другой реализации).
Но я не стал удалять этот фрагмент, а сделал разные версии этого текста для случаев, когда эта функциональность еще не готова и когда уже готова.
Для этого я использовал условные конструкции Asciidoc (`ifeval` в файле `oops.adoc`), проверяющие номер версии.
Понятно, что в реальном мире привязать варианты текста статьи к версиям релиза будет не очень просто и в таком случае лучше просто переписать статью, но здесь я сделал условные конструкции просто для демонстрации возможностей Asciidoc.